## 功能目标
- 在技能详情页增加“反馈”入口（小按钮/链接），点击后弹出小窗口（Modal）。
- 反馈内容：
  1) 分类不准确
  2) 无法安装该技能
  3) 地址已经无法访问了
  4) 其他意见（输入框，限制 100 字，显示字数计数）
- 仅登录用户允许提交；未登录则提示去登录。

## UI 交互
- 入口位置：标题行或分类标签附近，按钮文案：`反馈`。
- 弹窗内容：
  - 复选框（可多选）：上述 1~3 选项
  - 文本输入框：`其他意见`（`maxlength=100`，实时计数）
  - 提交/取消按钮；提交时禁用并显示加载状态
- 成功：关闭弹窗并提示“反馈已提交，谢谢！”；失败：提示错误原因。

## 前端实现（Vue3 + TS）
- 在 `src/pages/SkillDetailPage.vue`：
  - 新增状态：`showFeedbackModal`, `isSubmitting`, `selectedIssues: string[]`, `otherComment: string`
  - 新增方法：`openFeedback()`, `submitFeedback()`, `validateFeedback()`
  - 登录校验：使用 Supabase 客户端 `supabase.auth.getSession()`；无会话则提示登录（跳转 `/auth` 或弹引导）。
- 输入限制：`otherComment.trim().length <= 100`，且至少选择一项或填写其他意见。

```ts
/** 提交反馈 */
async function submitFeedback() {
  const session = await supabase.auth.getSession()
  if (!session?.data?.session) {
    alert('请先登录后再提交反馈')
    return
  }
  if (!selectedIssues.value.length && !otherComment.value.trim()) {
    alert('请选择至少一条反馈或填写其他意见')
    return
  }
  isSubmitting.value = true
  try {
    const payload = {
      skill_id: skill.value!.id,
      issues: selectedIssues.value,
      comment: otherComment.value.trim(),
    }
    const res = await fetch(`/api/skills/${payload.skill_id}/feedback`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        // 携带 Supabase access token 进行服务端鉴权
        Authorization: `Bearer ${session.data.session.access_token}`
      },
      body: JSON.stringify(payload)
    })
    if (!res.ok) throw new Error(await res.text())
    showFeedbackModal.value = false
    alert('反馈已提交，谢谢！')
  } catch (e) {
    alert('提交失败，请稍后再试')
  } finally {
    isSubmitting.value = false
  }
}
```

## 后端 API 与数据库
- 新增表：`public.skill_feedback`
  - `id uuid default gen_random_uuid()`
  - `skill_id uuid not null`（外键到 `skills.id`）
  - `user_id uuid not null`（提交者）
  - `issues text[] not null`（如：`{"分类不准确","无法安装该技能"}`）
  - `comment text`（≤100 字）
  - `created_at timestamptz default now()`
  - 索引：`(skill_id)`, `(user_id, skill_id, created_at)`
  - 速率限制（可选）：唯一约束 `(user_id, skill_id, date_trunc('hour', created_at))`，避免一小时内重复刷。

```sql
CREATE TABLE IF NOT EXISTS public.skill_feedback (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  skill_id uuid NOT NULL,
  user_id uuid NOT NULL,
  issues text[] NOT NULL,
  comment text,
  created_at timestamptz NOT NULL DEFAULT now()
);
CREATE INDEX IF NOT EXISTS idx_skill_feedback_skill ON public.skill_feedback (skill_id);
CREATE INDEX IF NOT EXISTS idx_skill_feedback_user_skill_time ON public.skill_feedback (user_id, skill_id, created_at);
-- 可选限流（每小时一条）：
-- ALTER TABLE public.skill_feedback ADD CONSTRAINT uniq_user_skill_hour
-- UNIQUE (user_id, skill_id, (date_trunc('hour', created_at)));
```

- 新增路由：`POST /api/skills/:id/feedback`
  - 鉴权：从 `Authorization: Bearer <supabase_access_token>` 解析用户
    - 服务端用 `supabase.auth.getUser(token)` 验证会话并得到 `user.id`
  - 校验：
    - `issues` 为非空数组或 `comment` 非空
    - `comment` 长度 ≤ 100
  - 插入：写入 `skill_feedback` 表
  - 返回：`201 { success: true }`

```ts
router.post('/skills/:id/feedback', async (req, res) => {
  try {
    const token = (req.headers.authorization || '').replace('Bearer ', '').trim()
    const supabase = getSupabase()
    const { data: userRes, error: userErr } = await supabase.auth.getUser(token)
    if (userErr || !userRes?.user) return res.status(401).json({ message: '未登录或令牌无效' })

    const skillId = String(req.params.id)
    const { issues = [], comment = '' } = req.body || {}
    const validComment = String(comment || '').trim()
    const validIssues = Array.isArray(issues) ? issues.map(String).filter(Boolean) : []
    if (validIssues.length === 0 && !validComment) {
      return res.status(400).json({ message: '缺少有效反馈内容' })
    }
    if (validComment.length > 100) {
      return res.status(400).json({ message: '其他意见最多100字' })
    }

    const { error } = await supabase
      .from('skill_feedback')
      .insert({ skill_id: skillId, user_id: userRes.user.id, issues: validIssues, comment: validComment })
    if (error) throw error
    res.status(201).json({ success: true })
  } catch (e: any) {
    res.status(500).json({ message: e?.message || '提交失败' })
  }
})
```

- 本地降级（可选）：若 Supabase 不可用，则写入 `api/data/feedback.dev.json`，字段结构一致。

## 安全与风控
- 登录态校验：仅持有有效 Supabase access token 的用户允许提交。
- 输入限制：服务端与前端均限制 `comment` ≤ 100 字。
- 速率限制：每小时同一用户对同一技能仅允许一次（可选唯一约束或应用层检查）。
- 数据脱敏与审计：记录 `user_id` 与时间戳，后台可导出审阅。

## 上线步骤
1. 数据库迁移：新增 `skill_feedback` 表（含索引/可选唯一约束）。
2. 后端：新增反馈提交路由并接入 Supabase 鉴权。
3. 前端：新增反馈按钮与弹窗；接入 `supabase.auth.getSession()` 校验；完善输入校验与提示。
4. 验证：登录用户提交反馈成功；未登录用户提示登录；超长/空反馈被拒绝。

## 备选方案（对比）
- 方案A（当前推荐）：数据库入库（Supabase）+ 后端路由
  - 优点：数据可审计、可统计；权限与限流可控
  - 缺点：需迁移与后端改动
- 方案B：发送邮件/Webhook 到运营邮箱/Slack
  - 优点：改动更小
  - 缺点：数据不在站内，不利于后续分析

---
请确认是否采用方案A（入库）并启用“每小时一条”的限流；确认后我将开始实现前端弹窗、后端路由与迁移脚本。